(function(){function e(){return!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}function c(){f.pause();$(window).resize(function(){h()});h();for(var e=0;e<22;e++){var t={note:"note"+e,ready:!0,visual:$("#note"+e)[0]};t.area={x:$("#note"+e).position().left,y:$("#note"+e).position().top,width:100,height:100};l.push(t)}p()}function h(){$("#canvas-source").css({width:$(window).width()-40,height:.75*($(window).width()-40)})}function p(){d();v();w();r=setTimeout(p,60)}function d(){u.drawImage(n,0,0,n.width,n.height)}function v(){var e=s.width,t=s.height,n=u.getImageData(0,0,e,t);i||(i=u.getImageData(0,0,e,t));var r=u.createImageData(e,t);b(r.data,n.data,i.data);a.putImageData(r,0,0);i=n}function m(e){return(e^e>>31)-(e>>31)}function g(e){return e>21?255:0}function y(e,t,n){if(t.length!=n.length)return null;var r=0;while(r<t.length*.25){e[4*r]=t[4*r]==0?0:m(t[4*r]-n[4*r]);e[4*r+1]=t[4*r+1]==0?0:m(t[4*r+1]-n[4*r+1]);e[4*r+2]=t[4*r+2]==0?0:m(t[4*r+2]-n[4*r+2]);e[4*r+3]=255;++r}}function b(e,t,n){if(t.length!=n.length)return null;var r=0;while(r<t.length*.25){var i=(t[4*r]+t[4*r+1]+t[4*r+2])/3,s=(n[4*r]+n[4*r+1]+n[4*r+2])/3,o=g(m(i-s));e[4*r]=o;e[4*r+1]=o;e[4*r+2]=o;e[4*r+3]=255;++r}}function w(){f.pause();for(var e=0;e<22;++e){var t=a.getImageData(l[e].area.x,l[e].area.y,l[e].area.width,l[e].area.height),n=0,r=0;while(n<t.data.length*.25){r+=(t.data[n*4]+t.data[n*4+1]+t.data[n*4+2])/3;++n}r=Math.round(r/(t.data.length*.25));$("#note"+e).addClass("active");$("#note"+e).css("opacity","0");if(r>10){$("#note"+e).css("opacity","1");l[e].note=="note0"?$("#my-video").addClass("sepia"):l[e].note=="note1"&&$("#my-video").removeClass("sepia");f.play()}}}var t=function(e){alert("Webcam error!",e)},n=$("#webcam")[0];navigator.getUserMedia?navigator.getUserMedia({audio:!0,video:!0},function(e){n.src=e;c()},t):navigator.webkitGetUserMedia&&navigator.webkitGetUserMedia({audio:!0,video:!0},function(e){n.src=window.webkitURL.createObjectURL(e);c()},t);var r,i,s=$("#canvas-source")[0],o=$("#canvas-blended")[0],u=s.getContext("2d"),a=o.getContext("2d"),f=$("#my-video")[0],l=[];u.translate(s.width,0);u.scale(-1,1)})();